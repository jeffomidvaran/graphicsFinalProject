<!DOCTYPE HTML> 
<html lang="en"> 
<head>
	<title>Final Project </title>
	<style>
		body {
			background-color: #EEEEEE;
		}
		label {
			white-space: pre;
		}
	</style>
	<meta charset="utf-8"> 


	<!-- VERTEX SHADER  -->
	<script type="x-shader/x-vertex" id="vshader-source" >
		attribute vec3 a_position;
		attribute vec3 a_normal;
		attribute vec3 a_color;

		uniform mat4 modelview;  
		uniform mat4 projection; 

		uniform mat3 normalMatrix;
		
		varying vec4 v_color;
		varying vec3 v_normal;  
		varying vec3 v_position; 

		void main(){
			vec4 position = vec4(a_position,1.0);
			vec4 eyeCoords = modelview * position;
			gl_Position = projection * eyeCoords;

			v_position = a_position; 
			v_normal = normalize(normalMatrix * a_normal);
			v_color = vec4(a_color, 1); 
		}


	</script>
	

	<script type="x-shader/x-fragment" id="fshader-source" >
		#ifdef GL_FRAGMENT_PRECISION_HIGH
			precision highp float;
		#else
			precision mediump float;
		#endif

		uniform mat4 modelview;  

		uniform int sunIsUp; 
		uniform int lightColoringInProgress; 

		uniform vec4 sunLightPosition; 
		uniform vec4 diffuseColor;
		uniform vec3 specularColor;
		uniform float specularExponent;

		uniform vec4 rightHeadLightPosition; 
		uniform vec4 leftHeadLightPosition; 

		varying vec4 v_color;
		varying vec3 v_normal;  
		varying vec3 v_position; 


		void main() {

			vec3 N, V; 
			N = v_normal; 
			vec4 ambientLight = 0.1 * diffuseColor;
			vec4 eye = modelview * vec4(v_position, 1.0); 
			V = normalize(-eye.xyz); 

			// ########################################### 
			// ######## Sun Light ######################## 
			// ########################################### 
			vec3 SL, sun_R;
			SL = normalize(sunLightPosition.xyz); 
			sun_R = -reflect(SL,N);

			vec4 sunDiffuseLight = 0.8 * diffuseColor * max(dot(N,SL), 0.0); 
			vec4 sunSpecularLight= 0.4 * vec4(specularColor.xyz, 1.0) * 
							    pow(max(dot(sun_R,V), 0.0), specularExponent); 

			vec4 sunLight = ambientLight + sunDiffuseLight + sunSpecularLight; 
			

			// ########################################### 
			// ######## STREET LIGHT ##################### 
			// ########################################### 

			vec3 PL, PL1, pole_R ; 

			vec4 poleLightPosition= vec4(0,0, -200,10); 
			PL = normalize(poleLightPosition.xyz/poleLightPosition.w - eye.xyz);
			vec4 plp1= vec4(0,0, -145,10); 
			PL1 = normalize(plp1.xyz/plp1.w - eye.xyz);


			float a = 0.2;
            float b = 0.2; 
            float c = 0.5; 
			float kd = 5.0; 
			float distance = pow(v_position.x - PL.x , 2.0) + pow(v_position.y - PL.y, 2.0) + pow(v_position.z - PL.z, 2.0); 
			vec4 streetLightBasic = kd * diffuseColor * max(dot(N,PL1), 0.0); 
			vec4 streetLightSpot = kd * diffuseColor * max(dot(N,PL), 0.0) / ( a + b * distance + c * pow(distance, 2.0)); 
			vec4 streetLight = 0.4 * streetLightBasic + streetLightSpot; 


			// ########################################### 
			// ######## LEFT HEADLIGHT ################### 
			// ########################################### 


			// dot(vectorToLightSource, uLightDirection) < limit 

			// vec4 leftHeadLightPosition = vec4(0,0,-145,10); 
			vec3 LHL; 
			// LHL = leftHeadLightPosition.xyz/leftHeadLightPosition.w - eye.xyz;
			LHL = normalize(leftHeadLightPosition.xyz/leftHeadLightPosition.w -eye.xyz);
				
			// vec4 leftHeadLight = diffuseColor * max(dot(N,LHL), 0.0);
			// gl_FragColor = v_color + leftHeadLight; 































 			// DAY TIME
 			if(lightColoringInProgress == 1 && sunIsUp == 1){
 				gl_FragColor = v_color + sunDiffuseLight * 0.2 + sunSpecularLight * 0.2; 
 			}
 			else if(lightColoringInProgress == 0 && sunIsUp == 1){
 				gl_FragColor = v_color + 1.5 *sunLight; 
 			}
 			// NIGHT TIME
 			else if(lightColoringInProgress == 1 && sunIsUp == 0){
 				gl_FragColor = v_color; 
 			}else if(lightColoringInProgress == 0 && sunIsUp == 0){
 				gl_FragColor = v_color + streetLight; 
 				// gl_FragColor = v_color + leftHeadlight;
 			}



		}

	</script>

	<script src="gl-matrix-min.js"></script> 
	<script type="text/javascript" src="webgl-utils.js"></script>
	<script src="trackball-rotator.js"></script>
	<script src="models.js"></script>   
	<script src="finalProject.js"></script>   


</head>


<body onload="init();">
	<form id="input_form">
		<fieldset>
			Name: Jeffrey Omidvaran <br/>
			Student ID: 32332249 <br/>
		</fieldset>
	</form>
	<label><b>Animate</b><input type="checkbox" id="animate"></label>
	<div id="canvas-holder"> </div>
		<canvas id="myGLCanvas" width="800" height="800"></canvas>
	</div>
</body>
</html>
