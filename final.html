<!DOCTYPE HTML> 
<html lang="en"> 
<head>
	<title>Final Project </title>
	<style>
		body {
			background-color: #EEEEEE;
		}
		label {
			white-space: pre;
		}
	</style>
	<meta charset="utf-8"> 


	<!-- VERTEX SHADER  -->
	<script type="x-shader/x-vertex" id="vshader-source" >
		attribute vec3 a_position;
		attribute vec3 a_normal;
		attribute vec3 a_color;

		uniform mat4 modelview;  // u_world
		uniform mat4 projection; // 

		uniform mat3 normalMatrix;
		uniform vec4 lightPosition;

		uniform vec4 diffuseColor;
		uniform vec3 specularColor;
		uniform float specularExponent;

		uniform vec4 poleLightPosition;
		uniform vec4 sunLightPosition; 
		uniform vec4 leftHeadlightPosition; 
		uniform vec4 rightHeadlightPosition; 

		uniform int sunIsUp; 
		
		varying vec4 v_color;

		void main(){

			vec4 position = vec4(a_position,1.0);
			vec4 eyeCoords = modelview * position;
			gl_Position = projection * eyeCoords;


			// #######################################################################
			// ######## DEFINE N,L,R,V ############################################### 
			// #######################################################################
			vec3 N, L, R, V, pL, sL, left_hL, right_hL;  

			N = normalize( normalMatrix * a_normal );

			if ( lightPosition.w == 0.0 ) {
				L = normalize( lightPosition.xyz );
				pL = normalize(poleLightPosition.xyz);
				sL = normalize(sunLightPosition.xyz);
				left_hL = normalize(leftHeadlightPosition.xyz); 
			}
			else {
				L = normalize( lightPosition.xyz/lightPosition.w - eyeCoords.xyz );
				pL = normalize(poleLightPosition.xyz/poleLightPosition.w - eyeCoords.xyz);
				sL = normalize(sunLightPosition.xyz/sunLightPosition.w - eyeCoords.xyz);
				left_hL =normalize(leftHeadlightPosition.xyz/leftHeadlightPosition.w - eyeCoords.xyz); 
			}

			R = -reflect(L,N);
			V = normalize( -eyeCoords.xyz);   
			

			// #######################################################################
			// ############## Lighting ############################################### 
			// #######################################################################
			
			float kd = 1.0;  // diffuse intensity
			float poleIntensity = 0.7;  // diffuse intensity


			float a = 0.25;
			float b = 0.25; 
			float c = 0.5; 
			float dist_pole_to_current = pow(a_position.x - poleLightPosition.x, 2.0) +
											  pow(a_position.y - poleLightPosition.y, 2.0) +
											  pow(a_position.z - poleLightPosition.z, 2.0) ;

			float f_att = 1.0/(a+b*dist_pole_to_current + pow(c * dist_pole_to_current,2.0)); 
			
			vec4 poleLight = poleIntensity * f_att * diffuseColor * max(dot(N,pL), 0.0);
			vec4 sunLight = kd * diffuseColor * max(dot(N,sL), 0.0);
			vec4 leftHeadlight = kd * diffuseColor * max(dot(N,left_hL), 0.0);

								
			// SUN LIGHTING 
			v_color = vec4(a_color * vec3(0.6,0.6,0.6), 1) + sunLight; 

			if(sunIsUp == 0){

				// POLE LIGHTING
				v_color = v_color + poleLight * 0.2; 

				// HEADLIGHTS
				// v_color = v_color + leftHeadlight * 2.0; 

				

			}






		}
	</script>
	

	<script type="x-shader/x-fragment" id="fshader-source" >
		#ifdef GL_FRAGMENT_PRECISION_HIGH
			precision highp float;
		#else
			precision mediump float;
		#endif


		varying vec4 v_color;

		void main() {
			gl_FragColor = v_color;
		}

	</script>

	<script src="gl-matrix-min.js"></script> 
	<script type="text/javascript" src="webgl-utils.js"></script>
	<script src="trackball-rotator.js"></script>
	<script src="models.js"></script>   
	<script src="finalProject.js"></script>   


</head>


<body onload="init();">
	<form id="input_form">
		<fieldset>
			Name: Jeffrey Omidvaran <br/>
			Student ID: 32332249 <br/>
		</fieldset>
	</form>
	<label><b>Animate</b><input type="checkbox" id="animate"></label>
	<div id="canvas-holder"> </div>
		<canvas id="myGLCanvas" width="800" height="800"></canvas>
	</div>
</body>
</html>
