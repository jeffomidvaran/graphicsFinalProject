<!DOCTYPE HTML> 
<html lang="en"> 
<head>
	<title>Final Project </title>
	<style>
		body {
			background-color: #EEEEEE;
		}
		label {
			white-space: pre;
		}
	</style>
	<meta charset="utf-8"> 


	<!-- VERTEX SHADER  -->
	<script type="x-shader/x-vertex" id="vshader-source" >
		attribute vec3 a_position;
		attribute vec3 a_normal;
		attribute vec3 a_color;

		uniform mat4 modelview;  
		uniform mat4 projection; 

		uniform mat3 normalMatrix;
		
		varying vec4 v_color;
		varying vec3 v_normal;  
		varying vec3 v_position; 
		varying vec4 v_eyeCoords; 

		void main(){
			vec4 position = vec4(a_position,1.0);
			vec4 eyeCoords = modelview * position;
			gl_Position = projection * eyeCoords;

			v_position = a_position; 
			v_eyeCoords = eyeCoords; 
			v_normal = normalize(normalMatrix * a_normal);
			v_color = vec4(a_color * vec3(0.6,0.6,0.6), 1); 
		}


	</script>
	

	<script type="x-shader/x-fragment" id="fshader-source" >
		#ifdef GL_FRAGMENT_PRECISION_HIGH
			precision highp float;
		#else
			precision mediump float;
		#endif


		uniform mat4 modelview;  
		uniform int sunIsUp; 

		uniform vec4 sunLightPosition; 
		uniform vec4 diffuseColor;
		uniform vec3 specularColor;
		uniform float specularExponent;

		uniform vec4 poleLightPosition; 


		varying vec4 v_color;
		varying vec3 v_normal;  
		varying vec4 v_eyeCoords; 
		varying vec3 v_position; 

		void main() {

			vec3 N; 
			N = v_normal; 

			// #################################### 
			// ######## Sun Light ################# 
			// #################################### 
			vec3 SL, R, V; 
			SL = normalize(sunLightPosition.xyz); 
			R = -reflect(SL,N);
			V = normalize( -v_eyeCoords.xyz); 

			vec4 ambientLight = 0.1 * diffuseColor;
			vec4 diffuseLight = 0.8 * diffuseColor * max(dot(N,SL), 0.0); 
			vec4 specularLight= 0.4 * vec4(specularColor.xyz, 1.0) * 
							    pow(max(dot(R,V), 0.0), specularExponent); 

			vec4 sunLight = ambientLight + diffuseLight + specularLight; 

			// #################################### 
			// ######## STREET LIGHT ############## 
			// #################################### 

			vec3 PL; 
			PL = normalize(poleLightPosition.xyz);

			float a = 0.25;
            float b = 0.25; 
            float c = 0.5; 
            float dist_pole_to_current = pow(v_position.x - poleLightPosition.x, 2.0) +
                                         pow(v_position.y - poleLightPosition.y, 2.0) +
                                         pow(v_position.z - poleLightPosition.z, 2.0) ;

			float f_att = 1.0/(a+ b*dist_pole_to_current + pow(c * dist_pole_to_current,2.0)); 
			vec4 poleLight = 0.3 * f_att * diffuseColor * max(dot(N,PL), 0.0);


			if(sunIsUp ==1 ){
				gl_FragColor = v_color + sunLight;
			}else{
				gl_FragColor = v_color + poleLight;
			}
		}

	</script>

	<script src="gl-matrix-min.js"></script> 
	<script type="text/javascript" src="webgl-utils.js"></script>
	<script src="trackball-rotator.js"></script>
	<script src="models.js"></script>   
	<script src="finalProject.js"></script>   


</head>


<body onload="init();">
	<form id="input_form">
		<fieldset>
			Name: Jeffrey Omidvaran <br/>
			Student ID: 32332249 <br/>
		</fieldset>
	</form>
	<label><b>Animate</b><input type="checkbox" id="animate"></label>
	<div id="canvas-holder"> </div>
		<canvas id="myGLCanvas" width="800" height="800"></canvas>
	</div>
</body>
</html>
